<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="vi">
<head>
    <meta charset="UTF-8">
    <title th:text="${staff != null and staff.id != null} ? 'Chỉnh sửa Nhân sự' : 'Thêm Nhân sự'">Thêm Nhân sự</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f8f9fa; }
        .form-control, .form-select { border-radius: 8px; }
        .form-title { font-weight: bold; margin-top: 20px; margin-bottom: 10px; }
        .avatar-upload img {
            border-radius: 50%;
            width: 120px;
            height: 120px;
            object-fit: cover;
        }
    </style>
</head>
<body>
<div class="container py-4">
    <h3 class="mb-4" th:text="${staff != null and staff.id != null} ? 'Chỉnh sửa Nhân sự' : 'Thêm Nhân sự mới'">Thêm Nhân sự mới</h3>

    <form th:action="@{/home/staff/save}" th:object="${staff}" method="post" enctype="multipart/form-data">
        <input type="hidden" th:field="*{id}" />

        <div class="row">
            <!-- Thông tin nhân sự bên trái -->
            <div class="col-md-9">
                <div class="mb-3">
                    <label class="form-label">Họ và tên *</label>
                    <input type="text" class="form-control" th:field="*{fullName}" required>
                </div>

                <div class="mb-3">
                    <label class="form-label">Email *</label>
                    <input type="email" class="form-control" th:field="*{email}" required>
                </div>

                <div class="mb-3">
                    <label class="form-label">Chức vụ</label>
                    <select class="form-select" th:field="*{position}">
                        <option value="">Chọn chức vụ</option>
                        <option value="Quản lý">Quản lý</option>
                        <option value="Nhân viên">Nhân viên</option>
                        <option value="Thực tập">Thực tập</option>
                    </select>
                </div>

                <div class="mb-3">
                    <label class="form-label">Vị trí (Gợi ý)</label>
                    <div class="d-flex flex-wrap gap-2">
                        <button type="button" class="btn btn-outline-secondary" onclick="setPosition('Software Engineer')">Software Engineer</button>
                        <button type="button" class="btn btn-outline-secondary" onclick="setPosition('Frontend Developer')">Frontend Developer</button>
                        <button type="button" class="btn btn-outline-secondary" onclick="setPosition('Backend Developer')">Backend Developer</button>
                        <button type="button" class="btn btn-outline-secondary" onclick="setPosition('Full Stack Developer')">Full Stack Developer</button>
                        <button type="button" class="btn btn-outline-secondary" onclick="setPosition('DevOps Engineer')">DevOps Engineer</button>
                        <button type="button" class="btn btn-outline-secondary" onclick="setPosition('Security Engineer')">Security Engineer</button>
                        <button type="button" class="btn btn-outline-secondary" onclick="setPosition('Data Scientist')">Data Scientist</button>
                        <button type="button" class="btn btn-outline-secondary" onclick="setPosition('Product Manager')">Product Manager</button>
                    </div>
                    <input type="text" class="form-control mt-2" th:field="*{position}" id="positionInput" placeholder="Nhập vị trí nếu không có trong danh sách">
                </div>

                <div class="mb-3">
                    <label class="form-label">Lương *</label>
                    <input type="number" class="form-control" th:field="*{salary}" required min="0">
                </div>

                <div class="mb-3">
                    <label class="form-label">Ngày bắt đầu làm việc</label>
                    <input type="date" class="form-control" th:field="*{startDate}">
                </div>

                <div class="mb-3">
                    <label class="form-label">Trạng thái</label>
                    <select class="form-select" th:field="*{status}">
                        <option value="">Chọn trạng thái</option>
                        <option value="Hoạt động">Hoạt động</option>
                        <option value="Nghỉ phép">Nghỉ phép</option>
                        <option value="Thực tập">Thực tập</option>
                    </select>
                </div>

                <div class="form-title">Quyền truy cập</div>
                
                <div class="row">
                    <div class="col-md-6">
                        <h6 class="text-primary">Quyền dự án</h6>
                        <div class="form-check form-switch mb-2">
                            <input class="form-check-input" type="checkbox" th:field="*{canViewProject}">
                            <label class="form-check-label">Xem dự án</label>
                        </div>
                        <div class="form-check form-switch mb-2">
                            <input class="form-check-input" type="checkbox" th:field="*{canEditProject}">
                            <label class="form-check-label">Chỉnh sửa dự án</label>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <h6 class="text-success">Quyền hợp đồng</h6>
                        <div class="form-check form-switch mb-2">
                            <input class="form-check-input" type="checkbox" th:field="*{canViewContract}">
                            <label class="form-check-label">Xem hợp đồng</label>
                        </div>
                        <div class="form-check form-switch mb-2">
                            <input class="form-check-input" type="checkbox" th:field="*{canEditContract}">
                            <label class="form-check-label">Chỉnh sửa hợp đồng</label>
                        </div>
                    </div>
                </div>

                <div class="row mt-3">
                    <div class="col-md-6">
                        <h6 class="text-warning">Quyền nhân sự</h6>
                        <div class="form-check form-switch mb-2">
                            <input class="form-check-input" type="checkbox" th:field="*{canViewStaff}">
                            <label class="form-check-label">Xem nhân sự</label>
                        </div>
                        <div class="form-check form-switch mb-2">
                            <input class="form-check-input" type="checkbox" th:field="*{canEditStaff}">
                            <label class="form-check-label">Chỉnh sửa nhân sự</label>
                        </div>
                    </div>
                </div>

                <div class="d-flex justify-content-end mt-4">
                    <button type="submit" class="btn btn-primary me-2">Lưu</button>
                    <a th:href="@{/home/staff}" class="btn btn-secondary">Quay lại</a>
                </div>
            </div>

            <!-- Avatar bên phải -->
            <div class="col-md-3 text-center">
                <div class="avatar-upload">
                    <img id="avatarPreview"
                         src="/img/default-avatar.png"
                         alt="avatar">
                    <div>
                        <button type="button" class="btn btn-sm btn-outline-secondary mt-2" onclick="toggleFileInput()">Chọn ảnh đại diện</button>
                        <input type="file" id="avatarFile" name="avatarFile" class="form-control mt-2 d-none" accept="image/*" onchange="previewImage(event)">
                    </div>
                </div>
            </div>
        </div>
    </form>
</div>

<script>
    function toggleFileInput() {
        const input = document.getElementById('avatarFile');
        input.classList.toggle('d-none');
    }

    function previewImage(event) {
        const reader = new FileReader();
        reader.onload = function () {
            document.getElementById('avatarPreview').src = reader.result;
        };
        reader.readAsDataURL(event.target.files[0]);
    }

    function setPosition(value) {
        document.getElementById('positionInput').value = value;
    }
</script>
</body>
</html>
